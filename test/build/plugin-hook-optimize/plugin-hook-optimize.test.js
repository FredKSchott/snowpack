const fs = require('fs');
const path = require('path');
const glob = require('glob');
const {setupBuildTest} = require('../../test-utils');

describe('plugin API: optimize()', () => {
  beforeAll(() => {
    setupBuildTest(__dirname);
  });

  it('generates artifact.txt', () => {
    // test 1: artifact.txt doesnâ€™t exist in src
    const files = glob.sync(path.join(__dirname, 'src'), {nodir: true});
    expect(files.join(',')).not.toEqual(expect.stringContaining('artifact.txt')); // note: this is a simple check if `artifact.txt` occurs in any part of a filename here

    // test 2: artifact.txt is generated by optimize() plugin hook
    const artifactLoc = path.join(__dirname, 'build', 'artifact.txt');
    expect(fs.existsSync(artifactLoc)).toBe(true);
  });
});
