{"version":3,"sources":["dist/hyperapp.js"],"names":["global","factory","exports","module","define","amd","hyperapp","this","h","name","attributes","rest","children","length","arguments","push","node","pop","nodeName","key","app","state","actions","view","container","skipRender","map","rootElement","oldNode","recycleElement","element","toLowerCase","call","childNodes","nodeType","nodeValue","lifecycle","isRecycling","globalState","clone","wiredActions","wireStateToActions","path","action","data","result","getPartialState","then","scheduleRender","setPartialState","concat","resolveNode","render","patch","parent","isSvg","newElement","createElement","insertBefore","removeElement","updateElement","oldKeyed","newKeyed","oldElements","oldChildren","i","oldKey","getKey","k","newKey","keyedNode","setTimeout","target","source","out","value","slice","eventListener","event","currentTarget","events","type","updateAttribute","oldValue","style","cssText","setProperty","addEventListener","removeEventListener","setAttribute","removeAttribute","document","createTextNode","createElementNS","oncreate","appendChild","oldAttributes","cb","onupdate","done","removeChild","removeChildren","ondestroy","onremove"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.hyperapp = {})));\n}(this, (function (exports) { 'use strict';\n\n  function h(name, attributes) {\n    var rest = [];\n    var children = [];\n    var length = arguments.length;\n\n    while (length-- > 2) rest.push(arguments[length]);\n\n    while (rest.length) {\n      var node = rest.pop();\n      if (node && node.pop) {\n        for (length = node.length; length--; ) {\n          rest.push(node[length]);\n        }\n      } else if (node != null && node !== true && node !== false) {\n        children.push(node);\n      }\n    }\n\n    return typeof name === \"function\"\n      ? name(attributes || {}, children)\n      : {\n          nodeName: name,\n          attributes: attributes || {},\n          children: children,\n          key: attributes && attributes.key\n        }\n  }\n\n  function app(state, actions, view, container) {\n    var map = [].map;\n    var rootElement = (container && container.children[0]) || null;\n    var oldNode = rootElement && recycleElement(rootElement);\n    var lifecycle = [];\n    var skipRender;\n    var isRecycling = true;\n    var globalState = clone(state);\n    var wiredActions = wireStateToActions([], globalState, clone(actions));\n\n    scheduleRender();\n\n    return wiredActions\n\n    function recycleElement(element) {\n      return {\n        nodeName: element.nodeName.toLowerCase(),\n        attributes: {},\n        children: map.call(element.childNodes, function(element) {\n          return element.nodeType === 3 // Node.TEXT_NODE\n            ? element.nodeValue\n            : recycleElement(element)\n        })\n      }\n    }\n\n    function resolveNode(node) {\n      return typeof node === \"function\"\n        ? resolveNode(node(globalState, wiredActions))\n        : node != null\n          ? node\n          : \"\"\n    }\n\n    function render() {\n      skipRender = !skipRender;\n\n      var node = resolveNode(view);\n\n      if (container && !skipRender) {\n        rootElement = patch(container, rootElement, oldNode, (oldNode = node));\n      }\n\n      isRecycling = false;\n\n      while (lifecycle.length) lifecycle.pop()();\n    }\n\n    function scheduleRender() {\n      if (!skipRender) {\n        skipRender = true;\n        setTimeout(render);\n      }\n    }\n\n    function clone(target, source) {\n      var out = {};\n\n      for (var i in target) out[i] = target[i];\n      for (var i in source) out[i] = source[i];\n\n      return out\n    }\n\n    function setPartialState(path, value, source) {\n      var target = {};\n      if (path.length) {\n        target[path[0]] =\n          path.length > 1\n            ? setPartialState(path.slice(1), value, source[path[0]])\n            : value;\n        return clone(source, target)\n      }\n      return value\n    }\n\n    function getPartialState(path, source) {\n      var i = 0;\n      while (i < path.length) {\n        source = source[path[i++]];\n      }\n      return source\n    }\n\n    function wireStateToActions(path, state, actions) {\n      for (var key in actions) {\n        typeof actions[key] === \"function\"\n          ? (function(key, action) {\n              actions[key] = function(data) {\n                var result = action(data);\n\n                if (typeof result === \"function\") {\n                  result = result(getPartialState(path, globalState), actions);\n                }\n\n                if (\n                  result &&\n                  result !== (state = getPartialState(path, globalState)) &&\n                  !result.then // !isPromise\n                ) {\n                  scheduleRender(\n                    (globalState = setPartialState(\n                      path,\n                      clone(state, result),\n                      globalState\n                    ))\n                  );\n                }\n\n                return result\n              };\n            })(key, actions[key])\n          : wireStateToActions(\n              path.concat(key),\n              (state[key] = clone(state[key])),\n              (actions[key] = clone(actions[key]))\n            );\n      }\n\n      return actions\n    }\n\n    function getKey(node) {\n      return node ? node.key : null\n    }\n\n    function eventListener(event) {\n      return event.currentTarget.events[event.type](event)\n    }\n\n    function updateAttribute(element, name, value, oldValue, isSvg) {\n      if (name === \"key\") ; else if (name === \"style\") {\n        if (typeof value === \"string\") {\n          element.style.cssText = value;\n        } else {\n          if (typeof oldValue === \"string\") oldValue = element.style.cssText = \"\";\n          for (var i in clone(oldValue, value)) {\n            var style = value == null || value[i] == null ? \"\" : value[i];\n            if (i[0] === \"-\") {\n              element.style.setProperty(i, style);\n            } else {\n              element.style[i] = style;\n            }\n          }\n        }\n      } else {\n        if (name[0] === \"o\" && name[1] === \"n\") {\n          name = name.slice(2);\n\n          if (element.events) {\n            if (!oldValue) oldValue = element.events[name];\n          } else {\n            element.events = {};\n          }\n\n          element.events[name] = value;\n\n          if (value) {\n            if (!oldValue) {\n              element.addEventListener(name, eventListener);\n            }\n          } else {\n            element.removeEventListener(name, eventListener);\n          }\n        } else if (\n          name in element &&\n          name !== \"list\" &&\n          name !== \"type\" &&\n          name !== \"draggable\" &&\n          name !== \"spellcheck\" &&\n          name !== \"translate\" &&\n          !isSvg\n        ) {\n          element[name] = value == null ? \"\" : value;\n        } else if (value != null && value !== false) {\n          element.setAttribute(name, value);\n        }\n\n        if (value == null || value === false) {\n          element.removeAttribute(name);\n        }\n      }\n    }\n\n    function createElement(node, isSvg) {\n      var element =\n        typeof node === \"string\" || typeof node === \"number\"\n          ? document.createTextNode(node)\n          : (isSvg = isSvg || node.nodeName === \"svg\")\n            ? document.createElementNS(\n                \"http://www.w3.org/2000/svg\",\n                node.nodeName\n              )\n            : document.createElement(node.nodeName);\n\n      var attributes = node.attributes;\n      if (attributes) {\n        if (attributes.oncreate) {\n          lifecycle.push(function() {\n            attributes.oncreate(element);\n          });\n        }\n\n        for (var i = 0; i < node.children.length; i++) {\n          element.appendChild(\n            createElement(\n              (node.children[i] = resolveNode(node.children[i])),\n              isSvg\n            )\n          );\n        }\n\n        for (var name in attributes) {\n          updateAttribute(element, name, attributes[name], null, isSvg);\n        }\n      }\n\n      return element\n    }\n\n    function updateElement(element, oldAttributes, attributes, isSvg) {\n      for (var name in clone(oldAttributes, attributes)) {\n        if (\n          attributes[name] !==\n          (name === \"value\" || name === \"checked\"\n            ? element[name]\n            : oldAttributes[name])\n        ) {\n          updateAttribute(\n            element,\n            name,\n            attributes[name],\n            oldAttributes[name],\n            isSvg\n          );\n        }\n      }\n\n      var cb = isRecycling ? attributes.oncreate : attributes.onupdate;\n      if (cb) {\n        lifecycle.push(function() {\n          cb(element, oldAttributes);\n        });\n      }\n    }\n\n    function removeChildren(element, node) {\n      var attributes = node.attributes;\n      if (attributes) {\n        for (var i = 0; i < node.children.length; i++) {\n          removeChildren(element.childNodes[i], node.children[i]);\n        }\n\n        if (attributes.ondestroy) {\n          attributes.ondestroy(element);\n        }\n      }\n      return element\n    }\n\n    function removeElement(parent, element, node) {\n      function done() {\n        parent.removeChild(removeChildren(element, node));\n      }\n\n      var cb = node.attributes && node.attributes.onremove;\n      if (cb) {\n        cb(element, done);\n      } else {\n        done();\n      }\n    }\n\n    function patch(parent, element, oldNode, node, isSvg) {\n      if (node === oldNode) ; else if (oldNode == null || oldNode.nodeName !== node.nodeName) {\n        var newElement = createElement(node, isSvg);\n        parent.insertBefore(newElement, element);\n\n        if (oldNode != null) {\n          removeElement(parent, element, oldNode);\n        }\n\n        element = newElement;\n      } else if (oldNode.nodeName == null) {\n        element.nodeValue = node;\n      } else {\n        updateElement(\n          element,\n          oldNode.attributes,\n          node.attributes,\n          (isSvg = isSvg || node.nodeName === \"svg\")\n        );\n\n        var oldKeyed = {};\n        var newKeyed = {};\n        var oldElements = [];\n        var oldChildren = oldNode.children;\n        var children = node.children;\n\n        for (var i = 0; i < oldChildren.length; i++) {\n          oldElements[i] = element.childNodes[i];\n\n          var oldKey = getKey(oldChildren[i]);\n          if (oldKey != null) {\n            oldKeyed[oldKey] = [oldElements[i], oldChildren[i]];\n          }\n        }\n\n        var i = 0;\n        var k = 0;\n\n        while (k < children.length) {\n          var oldKey = getKey(oldChildren[i]);\n          var newKey = getKey((children[k] = resolveNode(children[k])));\n\n          if (newKeyed[oldKey]) {\n            i++;\n            continue\n          }\n\n          if (newKey != null && newKey === getKey(oldChildren[i + 1])) {\n            if (oldKey == null) {\n              removeElement(element, oldElements[i], oldChildren[i]);\n            }\n            i++;\n            continue\n          }\n\n          if (newKey == null || isRecycling) {\n            if (oldKey == null) {\n              patch(element, oldElements[i], oldChildren[i], children[k], isSvg);\n              k++;\n            }\n            i++;\n          } else {\n            var keyedNode = oldKeyed[newKey] || [];\n\n            if (oldKey === newKey) {\n              patch(element, keyedNode[0], keyedNode[1], children[k], isSvg);\n              i++;\n            } else if (keyedNode[0]) {\n              patch(\n                element,\n                element.insertBefore(keyedNode[0], oldElements[i]),\n                keyedNode[1],\n                children[k],\n                isSvg\n              );\n            } else {\n              patch(element, oldElements[i], null, children[k], isSvg);\n            }\n\n            newKeyed[newKey] = children[k];\n            k++;\n          }\n        }\n\n        while (i < oldChildren.length) {\n          if (getKey(oldChildren[i]) == null) {\n            removeElement(element, oldElements[i], oldChildren[i]);\n          }\n          i++;\n        }\n\n        for (var i in oldKeyed) {\n          if (!newKeyed[i]) {\n            removeElement(element, oldKeyed[i][0], oldKeyed[i][1]);\n          }\n        }\n      }\n      return element\n    }\n  }\n\n  exports.h = h;\n  exports.app = app;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperapp.js.map\n"]}