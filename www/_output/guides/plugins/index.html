<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">

    <!-- Primary Meta Tags -->
    <title>Snowpack Plugin Guide</title>
    <meta name="title" content="Snowpack Plugin Guide">
    <meta name="description" content="Documentation and guides for building Snowpack plugins.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.snowpack.dev/guides/plugins/">
    <meta property="og:title" content="Snowpack Plugin Guide">
    <meta property="og:description" content="Documentation and guides for building Snowpack plugins.">
    <meta property="og:image" content="https://www.snowpack.dev/img/social-4.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.snowpack.dev/guides/plugins/">
    <meta property="twitter:title" content="Snowpack Plugin Guide">
    <meta property="twitter:description" content="Documentation and guides for building Snowpack plugins.">
    <meta property="twitter:image" content="https://www.snowpack.dev/img/social-4.jpg">

    <!-- Global Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Overpass:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/app.min.css" />
  </head>
  <body>

    <section class="container">
      <div class="grid-banner" style="display: none">
        <div class="notification">
            Snowpack 2.7 is here!
            <a href="/posts/2020-07-30-snowpack-2-7-release/">
              Read the launch post ‚Üí
            </a>
        </div>
      </div>
    </section>

    <section class="container grid-nav-container">
      <nav class="grid-nav">
        <svg id="toc-drawer-button" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
          <path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path>
        </svg>
        <a class="header-logo" href="/">
          <svg id="toc-logo" height="38px" viewBox="0 0 640 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g id="Page-1" stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
              <g id="mountain-solid" transform="translate(-1.000000, 0.000000)"fill-rule="nonzero">
                <path d="M635.92,462.7 L347.92,14.7 C342.03,5.54 331.89,0 321,0 C310.11,0 299.97,5.54 294.08,14.7 L6.08,462.7 C-0.250773249,472.547007 -0.699487627,485.064987 4.91,495.34 C10.522069,505.612419 21.2945349,512 33,512 L609,512 C620.71,512 631.48,505.61 637.09,495.33 C642.699457,485.058495 642.250708,472.543372 635.92,462.7 Z M321,91.18 L406.39,224 L321,224 L257,288 L218.94,249.94 L321,91.18 Z" id="Shape"></path>
              </g>
            </g>
          </svg>
          Snowpack
          </a>
        <form class="search-form hidden-mobile" data-controller="search">
          <a href="/#api-reference" class="grid-nav-link">API Reference</a>
          <a href="/#recipes" class="grid-nav-link">Recipes</a>
          <a href="/guides/plugins" class="grid-nav-link plugin-nav-link">Plugin Guide</a>
          <!-- <input type="text" name="search" placeholder="Search documentation..." class="search-form-input"></div> -->
        </form>
        <a href="https://github.com/snowpackjs/snowpack/discussions/1183" target="_blank" class="grid-nav-link">
              v2.14.3
            </a>
        <a href="https://github.com/snowpackjs/snowpack" target="_blank" class="icon-link hidden-mobile">
          <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
          </svg>
        </a>
        <a href="https://twitter.com/pikapkg" target="_blank" class="icon-link hidden-mobile">
          <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
          </svg>
        </a>
        <a href="https://discord.gg/rS8SnRk" target="_blank" class="icon-link hidden-mobile">
          <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 210 240"><path fill="currentColor" d="M84.79 90.45c-6.45 0-11.55 5.66-11.55 12.57s5.21 12.57 11.55 12.57c6.45 0 11.55-5.66 11.55-12.57.11-6.91-5.09-12.57-11.55-12.57zm41.32 0c-6.45 0-11.55 5.66-11.55 12.57s5.21 12.57 11.55 12.57c6.45 0 11.55-5.66 11.55-12.57s-5.09-12.57-11.55-12.57z"/><path fill="currentColor" d="M185.4 0H24.6C11.04 0 0 11.04 0 24.72v162.24c0 13.68 11.04 24.72 24.6 24.72h136.08l-6.36-22.2 15.36 14.28 14.52 13.44L210 240V24.72C210 11.04 198.96 0 185.4 0zm-46.32 156.72s-4.32-5.16-7.92-9.72c15.72-4.44 21.72-14.28 21.72-14.28-4.92 3.24-9.6 5.52-13.8 7.08-6 2.52-11.76 4.2-17.4 5.16-11.52 2.16-22.08 1.56-31.08-.12-6.84-1.32-12.72-3.24-17.64-5.16-2.76-1.08-5.76-2.4-8.76-4.08-.36-.24-.72-.36-1.08-.6-.24-.12-.36-.24-.48-.36-2.16-1.2-3.36-2.04-3.36-2.04s5.76 9.6 21 14.16c-3.6 4.56-8.04 9.96-8.04 9.96-26.52-.84-36.6-18.24-36.6-18.24 0-38.64 17.28-69.96 17.28-69.96 17.28-12.96 33.72-12.6 33.72-12.6l1.2 1.44c-21.6 6.24-31.56 15.72-31.56 15.72s2.64-1.44 7.08-3.48c12.84-5.64 23.04-7.2 27.24-7.56.72-.12 1.32-.24 2.04-.24 7.32-.96 15.6-1.2 24.24-.24 11.4 1.32 23.64 4.68 36.12 11.52 0 0-9.48-9-29.88-15.24l1.68-1.92s16.44-.36 33.72 12.6c0 0 17.28 31.32 17.28 69.96 0 0-10.2 17.4-36.72 18.24z"/></svg>
        </a>
      </nav>
    </section>

    <section class="container" style="display: flex;">
      
<aside class="grid-toc hidden-mobile">
  <nav class="toc">
                <ol>
                    
                    <li><a href="#plugin-overview">Plugin Overview</a>
            
                <ol>
                    
                    <li><a href="#build-plugins">Build Plugins</a>
            		</li>

                    <li><a href="#dev-tooling-plugins">Dev Tooling Plugins</a>
            		</li>

                    <li><a href="#bundler-plugins">Bundler Plugins</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#how-to-write-a-plugin">How to Write a Plugin</a>
            
                <ol>
                    
                    <li><a href="#getting-started">Getting Started</a>
            		</li>

                    <li><a href="#develop-and-test">Develop and Test</a>
            		</li>

                    <li><a href="#transform-a-file">Transform a File</a>
            		</li>

                    <li><a href="#build-from-source">Build From Source</a>
            		</li>

                    <li><a href="#multi-file-building">Multi-File Building</a>
            		</li>

                    <li><a href="#server-side-rendering-(ssr)">Server-Side Rendering (SSR)</a>
            		</li>

                    <li><a href="#optimizing-%26-bundling">Optimizing & Bundling</a>
            		</li>

                    <li><a href="#tips-%2F-gotchas">Tips / Gotchas</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#plugin-api">Plugin API</a>
            
                <ol>
                    
                    <li><a href="#knownentrypoints">knownEntrypoints</a>
            		</li>

                    <li><a href="#config()">config()</a>
            		</li>

                    <li><a href="#resolve">resolve</a>
            		</li>

                    <li><a href="#load()">load()</a>
            		</li>

                    <li><a href="#transform()">transform()</a>
            		</li>

                    <li><a href="#run()">run()</a>
            		</li>

                    <li><a href="#optimize()">optimize()</a>
            		</li>

                    <li><a href="#onchange()">onChange()</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#plugin-api-methods">Plugin API Methods</a>
            
                <ol>
                    
                    <li><a href="#this.markchanged()">this.markChanged()</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#publishing-a-plugin">Publishing a Plugin</a>
            		</li>

                    <li><a href="#back-to-main-docs">Back to Main Docs</a>
            		</li>
                </ol>
            </nav>
</aside>

<article id="grid-body" class="grid-body">
  <div class="grid-body-header">
    <svg height="64px" style="padding-left: 8px;" viewBox="0 0 640 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="Page-1" stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
        <g id="mountain-solid" transform="translate(-1.000000, 0.000000)"fill-rule="nonzero">
          <path d="M635.92,462.7 L347.92,14.7 C342.03,5.54 331.89,0 321,0 C310.11,0 299.97,5.54 294.08,14.7 L6.08,462.7 C-0.250773249,472.547007 -0.699487627,485.064987 4.91,495.34 C10.522069,505.612419 21.2945349,512 33,512 L609,512 C620.71,512 631.48,505.61 637.09,495.33 C642.699457,485.058495 642.250708,472.543372 635.92,462.7 Z M321,91.18 L406.39,224 L321,224 L257,288 L218.94,249.94 L321,91.18 Z" id="Shape"></path>
        </g>
      </g>
    </svg>
    <h1 class="header-snowpack">Snowpack</h1>
    <p class="header-snowpack-subtitle">
    THE <span class="highlight-container highlight-yellow">
        <span class="highlight">PLUGIN</span></span> GUIDE
  </p>
    <div style="margin: 0rem auto; max-width: 424px;">
      <a href="/" class="subtitle">Take me back to the main docs</a>
    </div>
  </div>
  <div class="markdown-body">
    <h4 id="who-is-this-page-for%3F">Who is this page for?</h4>
<ul>
<li>Anyone writing a custom plugin for Snowpack.</li>
<li>Anyone extending Snowpack‚Äôs default behavior.</li>
<li>Anyone adding framework-specific auto-HMR.</li>
<li>Anyone using Snowpack programmatically (ex: <code>snowpack.install()</code>).</li>
</ul>
<p>Looking for help using Snowpack in your project?
üëâ <strong><a href="/">Check out our main docs.</a></strong></p>
<h2 id="plugin-overview">Plugin Overview</h2>
<p>A <strong>Snowpack Plugin</strong> is an object interface that lets you customize Snowpack‚Äôs behavior. Snowpack provides different hooks for your plugin to connect to. For example, you can add a plugin to handle Svelte files, optimize CSS, convert SVGs to React components, run TypeScript during development, and much more.</p>
<p>Snowpack‚Äôs plugin interface is inspired by Rollup. If you‚Äôve ever written a Rollup plugin before, then hopefully these concepts and terms feel familiar.</p>
<h3 id="build-plugins">Build Plugins</h3>
<p>Snowpack uses an internal <strong>Build Pipeline</strong> to build files in your application for development and production. Every source file passes through the build pipeline, which means that Snowpack can build more than just JavaScript. Images, CSS, SVGs and more can all be built by Snowpack.</p>
<p>Snowpack runs each file through the build pipeline in two separate steps:</p>
<ol>
<li><strong>Load:</strong> Snowpack finds the first plugin that claims to <code>resolve</code> the given file. It then calls that plugin‚Äôs <code>load()</code> method to load the file into your application. This is where compiled languages (TypeScript, Sass, JSX, etc.) are loaded and compiled to something that can run on the web (JS, CSS, etc).</li>
<li><strong>Transform:</strong> Once loaded, every file passes through the build pipeline again to run through matching <code>transform()</code> methods of all plugins that offer the method. Plugins can transform a file to modify or augment its contents before finishing the file build.</li>
</ol>
<h3 id="dev-tooling-plugins">Dev Tooling Plugins</h3>
<p>Snowpack plugins support a <code>run()</code> method which lets you run any CLI tool and connect its output into Snowpack. You can use this to run your favorite dev tools (linters, TypeScript, etc.) with Snowpack and automatically report their output back through the Snowpack developer console. If the command fails, you can optionally fail your production build.</p>
<h3 id="bundler-plugins">Bundler Plugins</h3>
<p>Snowpack builds you a runnable, unbundled website by default, but you can optimize this final build with your favorite bundler (webpack, Rollup, Parcel, etc.) through the plugin <code>optimize()</code> method. When a bundler plugin is used, Snowpack will run the bundler on your build automatically to optimize it.</p>
<p>See our official <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-webpack">@snowpack/plugin-webpack</a> bundler plugin for an example of using the current interface.</p>
<h2 id="how-to-write-a-plugin">How to Write a Plugin</h2>
<h3 id="getting-started">Getting Started</h3>
<p>To create a Snowpack plugin, you can start with the following file template:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// my-snowpack-plugin.js</span><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'my-snowpack-plugin'</span><span class="token punctuation">,</span><br>    <span class="token comment">// ...</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-json"><code class="language-json"><span class="token comment">// snowpack.config.json</span><br><span class="token punctuation">{</span><br>  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"./my-snowpack-plugin.js"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property">"optionA"</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token property">"optionB"</span><span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>A Snowpack plugin should be distributed as a function that can be called with plugin-specific options to return a plugin object.
Snowpack will automatically call this function to load your plugin. That function accepts 2 parameters, in this order:</p>
<ol>
<li>the <a href="/#all-config-options">Snowpack configuration object</a> (<code>snowpackConfig</code>)</li>
<li>(optional) user-provided config options (<code>pluginOptions</code>)</li>
</ol>
<h3 id="develop-and-test">Develop and Test</h3>
<p>To develop and test a Snowpack plugin, the strategy is the same as with other npm packages:</p>
<ol>
  <li>Create your new plugin project (either with <code>npm init</code> or <code>yarn init</code>) with, for example, npm name: <code>my-snowpack-plugin</code> and paste in it the above-mentioned code snipped</li>
  <li>Run <code>npm link</code> in your plugin‚Äôs project folder to expose the plugin globally (in regard to your development machine).</li>
  <li>Create a new, example Snowpack project in a different location for testing</li>
  <li>
    In your example Snowpack project, run <code>npm install && npm link my-snowpack-plugin</code> (use the name from your plugin‚Äôs <code>package.json</code>).
    <ul>
      <li>Be aware that <code>npm install</code> will remove your linked plugin, so on any install, you will need to redo the <code>npm link my-snowpack-plugin</code>. </li>
      <li>(The alternative would be to use <code>npm install --save-dev &lt;folder_to_your_plugin_project&gt;</code>, which would create the "symlink-like" entry in your example Snowpack project‚Äôs <code>package.json</code>)</li>
    </ul>
  </li>
  <li>In your example Snowpack project, add your plugin to the <code>snowpack.config.json</code> along with any plugin options you‚Äôd like to test:
    <pre>
      <code class="json">
{
  "plugins": [
    ["my-snowpack-plugin", { "option-1": "testing", "another-option": false }]
  "
}
      </code>
    </pre>
  </li>
</ol>
<h3 id="transform-a-file">Transform a File</h3>
<p>For our first example, we‚Äôll look at transforming a file.</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'my-commenter-plugin'</span><span class="token punctuation">,</span><br>    <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">,</span> contents<span class="token punctuation">,</span> isDev<span class="token punctuation">,</span> fileExt<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/* I‚Äôm a comment! */ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contents<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>The object returned by this function is a <strong>Snowpack Plugin</strong>. A plugin consists of a <code>name</code> property and some hooks into the Snowpack lifecycle to customizes your build pipeline or dev environment. In the example above we have:</p>
<ul>
<li>The <strong>name</strong> property: The name of your plugin. This is usually the same as your package name if published to npm.</li>
<li>The <strong>transform</strong> method: A function that allows you to transform &amp; modify built files. In this case, we add a simple comment (<code>/* I‚Äôm a comment */</code>) to the beginning of every JS file¬†in your build.</li>
</ul>
<p>This covers the basics of single-file transformations. In our next example, we‚Äôll show how to compile a source file and change the file extension in the process.</p>
<h3 id="build-from-source">Build From Source</h3>
<p>When you build files from source, you also have the ability to transform the file type from source code to web code. In this example, we‚Äôll use Babel to load several types of files as input and output JavaScript in the final build:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'my-babel-plugin'</span><span class="token punctuation">,</span><br>    resolve<span class="token operator">:</span> <span class="token punctuation">{</span><br>      input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.mjs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      output<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>filePath<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> babel<span class="token punctuation">.</span><span class="token function">transformFileAsync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> result<span class="token punctuation">.</span>code<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>This is a simplified version of the official Snowpack Babel plugin, which builds all JavaScript, TypeScript, and JSX files in your application with the <code>load()</code> method.</p>
<p>The <code>load()</code> method is responsible for loading and build files from disk while the <code>resolve</code> property tells Snowpack which files the plugin can load and what to expect as output. In this case, the plugin claims responsibility for files matching any of the file extensions found in <code>resolve.input</code>, and outputs <code>.js</code> JavaScript (declared via <code>resolve.output</code>).</p>
<p><strong>See it in action:</strong> Let‚Äôs say that we have a source file at <code>src/components/App.jsx</code>. Because the <code>.jsx</code> file extension matches an extension in our plugin‚Äôs <code>resolve.input</code> array, Snowpack lets this plugin claim responsibility for loading this file. <code>load()</code> executes, Babel builds the JSX input file from disk, and JavaScript is returned to the final build.</p>
<h3 id="multi-file-building">Multi-File Building</h3>
<p>For a more complicated example, we‚Äôll take one input file (<code>.svelte</code>) and use it to generate 2 output files (<code>.js</code> and <code>.css</code>).</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises<span class="token punctuation">;</span><br><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"svelte/compiler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'my-svelte-plugin'</span><span class="token punctuation">,</span><br>    resolve<span class="token operator">:</span> <span class="token punctuation">{</span><br>      input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.svelte'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      output<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> filePath <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> fileContents <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> <span class="token punctuation">{</span> js<span class="token punctuation">,</span> css <span class="token punctuation">}</span> <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>codeToCompile<span class="token punctuation">,</span> <span class="token punctuation">{</span> filename<span class="token operator">:</span> filePath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        <span class="token string">'.js'</span><span class="token operator">:</span> js <span class="token operator">&amp;&amp;</span> js<span class="token punctuation">.</span>code<span class="token punctuation">,</span><br>        <span class="token string">'.css'</span><span class="token operator">:</span> css <span class="token operator">&amp;&amp;</span> css<span class="token punctuation">.</span>code<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>This is a simplified version of the official Snowpack Svelte plugin. Don‚Äôt worry if you‚Äôre not familiar with Svelte, just know that building a Svelte file (<code>.svelte</code>) generates both JS &amp; CSS for our final build.</p>
<p>In that case, the <code>resolve</code> property only takes a single <code>input</code> file type (<code>['.svelte']</code>) but two <code>output</code> file types (<code>['.js', '.css']</code>). This matches the result of Svelte‚Äôs build process and the returned entries of our <code>load()</code> method.</p>
<p><strong>See it in action:</strong> Let‚Äôs say that we have a source file at <code>src/components/App.svelte</code>. Because the <code>.svelte</code> file extension matches an extension in our plugin‚Äôs <code>resolve.input</code> array, Snowpack lets this plugin claim responsibility for loading this file. <code>load()</code> executes, Svelte builds the file from disk, and both JavaScript &amp; CSS are returned to the final build.</p>
<p>Notice that <code>.svelte</code> is missing from <code>resolve.output</code> and isn‚Äôt returned by <code>load()</code>. Only the files returned by the <code>load()</code> method are included in the final build. If you wanted your plugin to keep the original source file in your final build, you could add <code>{ '.svelte': contents }</code> to the return object.</p>
<h3 id="server-side-rendering-(ssr)">Server-Side Rendering (SSR)</h3>
<p>Plugins can produce server-optimized code for SSR via the <code>load()</code> plugin hook. The <code>isSSR</code> flag tells the plugin that Snowpack is requesting your file for the server, and that it will expect a response that will run on the server.</p>
<p>Some frameworks/languages (like React) run the same code on both the browser and the server. Others (like Svelte) will create different output for the server than the browser. In the example below, we use the <code>isSSR</code> flag to tell the Svelte compiler to generate server-optimized code when requested by Snowpack.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'basic-svelte-plugin'</span><span class="token punctuation">,</span><br>    resolve<span class="token operator">:</span> <span class="token punctuation">{</span><br>      input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.svelte'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      output<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>filePath<span class="token punctuation">,</span> isSSR<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> svelteOptions <span class="token operator">=</span> <span class="token punctuation">{</span><br>        <span class="token comment">/* ... */</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> codeToCompile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> result <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>codeToCompile<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">...</span>svelteOptions<span class="token punctuation">,</span> ssr<span class="token operator">:</span> isSSR<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// ...</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>If you‚Äôre not sure if your plugin needs special SSR support, you are probably fine to skip this and ignore the <code>isSSR</code> flag in your plugin. Many languages won‚Äôt need this, and SSR is always an intentional opt-in by the user.</p>
<h3 id="optimizing-%26-bundling">Optimizing &amp; Bundling</h3>
<p>Snowpack supports pluggable bundlers and other build optimizations via the <code>optimize()</code> hook. This method runs after the build and gives plugins a chance to optimize the final build directory. Webpack, Rollup, and other build-only optimizations should use this hook.</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">snowpackConfig<span class="token punctuation">,</span> pluginOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'my-custom-webpack-plugin'</span><span class="token punctuation">,</span><br>    <span class="token keyword">async</span> <span class="token function">optimize</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> buildDirectory <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">await</span> webpack<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>This is an (obviously) simplified version of the <code>@snowpack/plugin-webpack</code> plugin. When the build command has finished building your application, this plugin hook is called with the <code>buildDirectory</code> path as an argument. It‚Äôs up to the plugin to read build files from this directory and write any changes back to the directory. Changes should be made in place, so only write files at the end and be sure to clean up after yourself (if a file is no longer needed after optimizing/bundling, it is safe to remove).</p>
<h3 id="tips-%2F-gotchas">Tips / Gotchas</h3>
<ul>
<li>Remember: A source file will always be loaded by the first <code>load()</code> plugin to claim it, but the build result will be run through every <code>transform</code> function.</li>
<li>Snowpack will always keep the original file name (<code>App</code>) and only ever change the extension in the build.</li>
<li>Extensions in Snowpack always have a leading <code>.</code> character (e.g. <code>.js</code>, <code>.ts</code>). This is to match Node‚Äôs <code>path.extname()</code> behavior, as well as make sure we‚Äôre not matching extension substrings (e.g. if we matched <code>js</code> at the end of a file, we also don‚Äôt want to match <code>.mjs</code> files by accident; we want to be explicit there).</li>
<li>The <code>resolve.input</code> and <code>resolve.output</code> file extension arrays are vital to how Snowpack understands your build pipeline, and are always required for <code>load()</code> to run correctly.</li>
<li>If <code>load()</code> doesn‚Äôt return anything, the file isn‚Äôt loaded and the <code>load()</code> of the next suitable plugin is called.</li>
<li>If <code>transform()</code> doesn‚Äôt return anything, the file isn‚Äôt transformed.</li>
<li>If you want to build a plugin that only runs some code on initialization (such as <code>@snowpack/plugin-dotenv</code>), put your side-effect code inside the function that returns your plugin. But be sure to still return a plugin object. A simple <code>{ name }</code> object will do.</li>
</ul>
<h2 id="plugin-api">Plugin API</h2>
<p>Check out our <a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">‚ÄúSnowpackPlugin‚Äù TypeScript definition</a> for a fully documented and up-to-date summary of the Plugin API and all supported options.</p>
<h3 id="knownentrypoints">knownEntrypoints</h3>
<pre><code>// Example: Svelte plugin needs to make sure this dependency can be loaded.
knownEntrypoints: [&quot;svelte/internal&quot;]
</code></pre>
<p>An list of any npm dependencies that are added as a part of <code>load()</code> or <code>transform()</code> that Snowpack will need to know about. Snowpack analyzes most dependency imports automatically when it scans the source code of a project, but some imports are added as a part of a <code>load()</code> or <code>transform()</code> step, which means that Snowpack would never see them. If your plugin does this, add them here.</p>
<h3 id="config()">config()</h3>
<pre class="language-js"><code class="language-js"><span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">snowpackConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// modify or read from the Snowpack configuration object</span><br><span class="token punctuation">}</span></code></pre>
<p>Use this hook to read or make changes to the completed Snowpack configuration object. This is currently the recommended way to access the Snowpack configuration, since the one passed to the top-level plugin function is not yet finalized and may be incomplete.</p>
<ul>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="resolve">resolve</h3>
<pre><code>// Example: Sass plugin compiles Sass files to CSS.
resolve: {input: [&quot;.sass&quot;], output: [&quot;.css&quot;]}

// Example: Svelte plugin compiles Svelte files to JS &amp; CSS.
resolve: {input: [&quot;.svelte&quot;], output: [&quot;.js&quot;,[&quot;.css&quot;]}
</code></pre>
<p>If your plugin defines a <code>load()</code> method, Snowpack will need to know what files your plugin is responsible to load and what its output will look like. <strong><code>resolve</code> is only needed if you also define a <code>load()</code> method.</strong></p>
<ul>
<li><code>input</code>: An array of file extensions that this plugin will load.</li>
<li><code>output</code>: The set of all file extensions that this plugin‚Äôs <code>load()</code> method will output.</li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="load()">load()</h3>
<p>Load a file from disk and build it for your application. This is most useful for taking a file type that can‚Äôt run in the browser (TypeScript, Sass, Vue, Svelte) and returning JS and/or CSS. It can even be used to load JS/CSS files directly from disk with a build step like Babel or PostCSS.</p>
<ul>
<li>See above for an example of how to use this method.</li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="transform()">transform()</h3>
<p>Transform a file‚Äôs contents. Useful for making changes to all types of output (JS, CSS, etc.) regardless of how they were loaded from disk.</p>
<ul>
<li>See above for an example of how to use this method.</li>
<li>Example: <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-postcss">@snowpack/plugin-postcss</a></li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="run()">run()</h3>
<p>Run a CLI command, and connect it‚Äôs output into the Snowpack console. Useful for connecting tools like TypeScript.</p>
<ul>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="optimize()">optimize()</h3>
<p>Snowpack‚Äôs bundler plugin API is still experimental and may change in a future release. See our official bundler plugins for an example of using the current interface:</p>
<ul>
<li>Example: <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-webpack">@snowpack/plugin-webpack</a></li>
<li>Example: <a href="https://github.com/ParamagicDev/snowpack-plugin-rollup-bundle">snowpack-plugin-rollup-bundle</a></li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h3 id="onchange()">onChange()</h3>
<p>Get notified any time a watched file changes. This can be useful when paired with the <code>markChanged()</code> plugin method, to mark multiple files changed at once.</p>
<ul>
<li>See <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-sass/plugin.js">@snowpack/plugin-sass</a> for an example of how to use this method.</li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h2 id="plugin-api-methods">Plugin API Methods</h2>
<h3 id="this.markchanged()">this.markChanged()</h3>
<pre class="language-js"><code class="language-js"><span class="token comment">// Called inside any plugin hooks</span><br><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">markChanged</span><span class="token punctuation">(</span><span class="token string">'/some/file/path.scss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Manually mark a file as changed, regardless of whether the file changed on disk or not. This can be useful when paired with the <code>markChanged()</code> plugin hook, to mark multiple files changed at once.</p>
<ul>
<li>See <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-sass/plugin.js">@snowpack/plugin-sass</a> for an example of how to use this method.</li>
<li><a href="https://github.com/snowpackjs/snowpack/tree/master/snowpack/src/types/snowpack.ts">Full TypeScript definition</a>.</li>
</ul>
<h2 id="publishing-a-plugin">Publishing a Plugin</h2>
<p>To share a plugin with the world, you can publish it to npm. For example, take a look at <a href="https://github.com/snowpackjs/snowpack-plugin-starter-template">snowpack-plugin-starter-template</a> which can get you up-and-running quickly. You can either copy this outright or simply take what you need.</p>
<p>In general, make sure to mind the following checklist:</p>
<ul>
<li>‚úîÔ∏è Your <code>package.json</code> file has a <code>main</code> entry pointing to the final build</li>
<li>‚úîÔ∏è Your code is compiled to run on Node &gt;= 10</li>
<li>‚úîÔ∏è Your package README contains a list of custom options, if your plugin is configurable</li>
</ul>
<h2 id="back-to-main-docs">Back to Main Docs</h2>
<p>üëâ <strong><a href="/">Back to the main docs.</a></strong></p>

  </div>
</article>
    </section>

  </body>

  <script>

    /**
    * Debounce functions for better performance
    * (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com
    * @param  {Function} fn The function to debounce
    */
    function debounce(fn) {
      // Setup a timer
      var timeout;
      // Return a function to run debounced
      return function () {
        // Setup the arguments
        var context = this;
        var args = arguments;
        // If there's a timer, cancel it
        if (timeout) {
          window.cancelAnimationFrame(timeout);
        }
        // Setup the new requestAnimationFrame()
        timeout = window.requestAnimationFrame(function () {
          fn.apply(context, args);
        });
      }
    };

    function isScrolledIntoView(el) {
      const rect = el.getBoundingClientRect();
      const elemTop = rect.top;
      const elemBottom = rect.bottom;
      // Only completely visible elements return true:
      // var isVisible = (elemTop >= 0) && (elemBottom <= window.innerHeight);
      // Partially visible elements return true:
      const isVisible = elemTop < window.innerHeight && elemBottom >= 0;
      return isVisible;
    }

    function setActiveToc() {
      const PADDING_TOP = 64;

      for (const el of document.querySelectorAll('h2, h3, h4')) {
        if (!isScrolledIntoView(el)) {
          continue;
        }

        const elId = el.id;
        const href = `#${elId}`;
        tableOfContentsEl
          .querySelectorAll(`a.active`)
          .forEach(aEl => {
            if (aEl.getAttribute('href') !== href) aEl.classList.remove('active');
          });

        const tocEl = tableOfContentsEl.querySelector(`a[href="${href}"]`);
        // only add the active class once, which will also prevent scroll from re-triggering while scrolling to the same element
        if (!tocEl || tocEl.classList.contains('active')) {
          return;
        }
        tocEl.classList.add('active')

        // update nav on desktop
        if (window.innerWidth >= 860) {
          gridTocEl.scrollTo({ top: tocEl.getBoundingClientRect().top + gridTocEl.scrollTop - PADDING_TOP, behavior: 'smooth'})
        }
        return;
      }
    }

    const gridBodyEl = document.getElementById('grid-body');
    const tableOfContentsEl = document.querySelector('.toc');
    const gridTocEl = document.querySelector('.grid-toc');
    gridBodyEl.addEventListener('scroll', debounce(setActiveToc));
    window.addEventListener('scroll', debounce(setActiveToc));

    document
      .getElementById('toc-drawer-button')
      .addEventListener('click', (e) => {
        e.preventDefault();
        /*If hidden-mobile class is enabled that means we are on desktop do overflow normal but we
      if we are at mobile fixed body position, so that its not scrollable(which currently causing bug) and navbar  handling its
      owns scroll. Case to consider there are chance use can open navbar using toggle button and user when click on any link
      body postion should be unset
      */
        const ishiddenMobileClassEnabled = gridTocEl
          .classList
          .toggle('hidden-mobile');
      });
    gridTocEl.addEventListener('click', (e) => {
      gridTocEl
        .classList
        .add('hidden-mobile');
      document.body.style.position = '';
    });
    /* May not be needed:
    window.addEventListener('DOMContentLoaded', (event) => {
      if (!window.location.hash) {
        return;
      }
      const elNeedingScroll = document.getElementById(window.location.hash.substring(1));
      if (!elNeedingScroll) {
        return;
      }
      elNeedingScroll.scrollIntoView();
      elNeedingScroll.classList.add('highlighted');
    });
    */

    window.addEventListener('DOMContentLoaded', (event) => {
      setActiveToc();
      document
        .querySelectorAll('.markdown-body h3, .markdown-body h4')
        .forEach((headerEl) => {
          const linkEl = document.createElement("a");
          // linkEl.setAttribute('target', "_blank");
          linkEl.setAttribute('href', '#' + headerEl.id);
          linkEl
            .classList
            .add('header-link');
          linkEl.innerText = '#';
          headerEl.appendChild(linkEl);
        });
    });
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130280175-9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-130280175-9');
  </script>
</html>
